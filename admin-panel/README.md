# 🎨 Figma Bulk Export by Sections

**Мощный плагин для массового экспорта изображений из Figma с системой подписки**

[![License](https://img.shields.io/badge/license-MIT-blue.svg)](LICENSE)
[![Figma Plugin](https://img.shields.io/badge/figma-plugin-ff7262.svg)](https://www.figma.com/)
[![Supabase](https://img.shields.io/badge/backend-supabase-green.svg)](https://supabase.com/)

---

## 📋 О проекте

Figma Bulk Export by Sections — это плагин для Figma, который позволяет автоматизировать экспорт большого количества фреймов, организованных по секциям. Плагин включает в себя полноценную систему подписки с привязкой к устройству, офлайн-режимом и веб-панелью администратора.

### ✨ Основные возможности

#### 🎯 Экспорт изображений:
- **Массовый экспорт** всех фреймов из выбранных секций
- **Множественные форматы**: PNG, JPG, SVG
- **Настройка масштаба**: 1x, 2x, 3x
- **ZIP архивы** для удобного скачивания
- **Организация по папкам** (секция → фреймы)

#### 🔐 Система подписки:
- **Лицензионные ключи** с привязкой к email
- **Одна лицензия = одно устройство**
- **Офлайн работа** до 7 дней
- **Автоматическая проверка** срока действия
- **Три тарифных плана**: месячный, квартальный, годовой

#### 👨‍💼 Административная панель:
- **Управление подписками** через веб-интерфейс
- **Статистика** по пользователям и доходам
- **Создание лицензий** вручную
- **Email уведомления** для пользователей
- **Экспорт данных** в CSV

## 🚀 Быстрый старт

### 1. Скачивание проекта

```bash
git clone https://github.com/yourusername/figma-bulk-export-plugin.git
cd figma-bulk-export-plugin
```

### 2. Установка плагина в Figma

1. Откройте **Figma Desktop** (не веб-версию)
2. Перейдите в меню: **Plugins → Development**
3. Нажмите **"Import plugin from manifest"**
4. Выберите файл `manifest.json` из скачанного проекта
5. Плагин появится в списке разработки

### 3. Тестирование системы

Запустите локальный сервер для тестирования:

```bash
python3 -m http.server 8000
```

Откройте в браузере: http://localhost:8000/test-final.html

### 4. Тестовые данные

Для тестирования используйте:
- **Email**: test@demo.com
- **Лицензионный ключ**: TEST-271382-DEMO
- **Админ-ключ**: figma-admin-2024-secure-key

## ⚙️ Настройка продакшн среды

### Настройка Supabase Backend

1. **Создайте проект** на [supabase.com](https://supabase.com)
2. **Обновите конфигурацию** в файле `config.js`:

```javascript
const PLUGIN_CONFIG = {
  SUPABASE: {
    URL: 'https://your-project.supabase.co',
    ANON_KEY: 'your_anon_key',
    SERVICE_ROLE_KEY: 'your_service_role_key'
  }
  // ... остальные настройки
};
```

3. **Выполните SQL скрипты** в Supabase Dashboard → SQL Editor:
   - `supabase-functions-final.sql` - основные функции API
   - `email-notifications.sql` - система email уведомлений
   - `fix-rls-policies.sql` - настройки безопасности

### Настройка платежной системы (опционально)

Для приема платежей интегрируйте YooKassa:

1. Зарегистрируйтесь на [yookassa.ru](https://yookassa.ru)
2. Получите Shop ID и Secret Key
3. Обновите настройки в `config.js`
4. Настройте webhook для автоматической активации подписок

## 🎯 Использование

### Для пользователей

1. **Запустите плагин** в Figma Desktop
2. **Введите email и лицензионный ключ** для активации
3. **Создайте секции** в Figma с фреймами для экспорта
4. **Настройте параметры** экспорта (формат, масштаб)
5. **Нажмите "Начать экспорт"** для массового экспорта

### Для администраторов

1. **Откройте админ-панель**: http://localhost:8000/admin-panel.html
2. **Авторизуйтесь** с помощью админ-ключа
3. **Управляйте подписками**: создавайте, продлевайте, деактивируйте
4. **Отслеживайте статистику** пользователей и доходов
5. **Настройте email уведомления** для автоматической отправки

## 📁 Структура проекта

```
figma-bulk-export-plugin/
├── 🔌 Основные файлы плагина
│   ├── manifest.json          # Манифест плагина Figma
│   ├── code-simple.js         # Основная логика плагина
│   └── ui-final.html          # Пользовательский интерфейс
│
├── ⚙️ Backend и конфигурация
│   ├── config.js              # Настройки системы
│   ├── supabase-functions-final.sql  # SQL функции API
│   ├── email-notifications.sql       # Система email
│   └── fix-rls-policies.sql         # Настройки безопасности
│
├── 🌐 Веб-интерфейсы
│   ├── test-final.html        # Страница тестирования
│   └── admin-panel.html       # Панель администратора
│
├── 🔧 Инструменты тестирования
│   ├── test-supabase-connection.js  # Node.js тест подключения
│   └── test-sql-functions.js        # Node.js тест SQL функций
│
└── 📚 Документация
    ├── README.md              # Этот файл
    ├── DEPLOYMENT.md          # Инструкции по развертыванию
    └── LICENSE                # Лицензия MIT
```

## 🛠️ Технические детали

### Архитектура системы

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Figma Plugin  │◄──►│    Supabase     │◄──►│   YooKassa      │
│                 │    │                 │    │   (опционально) │
│ • Авторизация   │    │ • PostgreSQL    │    │ • Платежи       │
│ • Экспорт       │    │ • SQL Functions │    │ • Webhook       │
│ • Офлайн кэш    │    │ • RLS Security  │    │                 │
└─────────────────┘    └─────────────────┘    └─────────────────┘
           │                      │
           │            ┌─────────────────┐
           └───────────►│ Админ-панель    │
                        │ • Управление    │
                        │ • Статистика    │
                        │ • Email логи    │
                        └─────────────────┘
```

### Используемые технологии

- **Frontend**: Vanilla JavaScript, HTML5, CSS3
- **Backend**: Supabase (PostgreSQL + Edge Functions)
- **Платежи**: YooKassa API (для российского рынка)
- **Email**: Resend/SendGrid/SMTP
- **Безопасность**: Row Level Security (RLS), JWT токены
- **Кэширование**: LocalStorage для офлайн работы

### Бизнес-модель

**Тарифные планы:**
- 🗓️ **Месячная подписка**: 500₽/месяц
- 📅 **Квартальная подписка**: 1200₽/квартал (скидка 20%)
- 🗓️ **Годовая подписка**: 4000₽/год (скидка 33%)

**Ожидаемая экономика при 100 пользователях:**
- Месячный доход: ~50,000₽
- Расходы на инфраструктуру: ~2,000₽
- Чистая прибыль: ~48,000₽/месяц

## 🔒 Безопасность

### Реализованные меры защиты

- **Row Level Security** в базе данных
- **Привязка лицензии к устройству** (device fingerprinting)
- **Валидация данных** на сервере
- **Шифрование API ключей**
- **HTTPS для всех соединений**
- **Защита от повторного использования** лицензий

### Рекомендации

- Регулярно меняйте API ключи (каждые 6 месяцев)
- Мониторьте подозрительную активность
- Делайте резервные копии базы данных
- Используйте сложные админ-ключи

## 🧪 Тестирование

### Автоматические тесты

```bash
# Тест подключения к Supabase
node test-supabase-connection.js

# Тест SQL функций
node test-sql-functions.js
```

### Веб-интерфейс тестирования

Откройте http://localhost:8000/test-final.html для:
- Проверки всех компонентов системы
- Тестирования создания подписок
- Проверки SQL функций
- Симуляции работы плагина

### Ручное тестирование

1. **Импортируйте плагин** в Figma Desktop
2. **Создайте тестовые секции** с фреймами
3. **Активируйте подписку** с тестовыми данными
4. **Протестируйте экспорт** в разных форматах
5. **Проверьте офлайн режим**

## 📧 Email уведомления

Система поддерживает автоматические email уведомления:

### Типы уведомлений
- 🎉 **Новая подписка** - welcome письмо с лицензионным ключом
- ⏰ **Истечение подписки** - напоминание за 3 дня
- ✅ **Продление подписки** - подтверждение продления

### Настройка
1. Выберите email провайдера (Resend/SendGrid)
2. Получите API ключ
3. Настройте переменные окружения в Supabase
4. Выполните SQL из `email-notifications.sql`

## 📊 Мониторинг и аналитика

### Ключевые метрики

- **Конверсия** пробных → платных пользователей
- **Retention** - процент продлений подписки
- **ARPU** - средний доход с пользователя
- **Churn rate** - процент отказов от продления

### Инструменты мониторинга

- **Supabase Dashboard** - логи и метрики API
- **Админ-панель** - статистика пользователей
- **Email логи** - отслеживание уведомлений

## ❓ Частые вопросы (FAQ)

### Для пользователей

**Q: Работает ли плагин в веб-версии Figma?**
A: Нет, плагин работает только в Figma Desktop из-за ограничений API экспорта.

**Q: Можно ли использовать одну лицензию на нескольких компьютерах?**
A: Нет, одна лицензия привязывается к одному устройству. Для сброса привязки обратитесь к администратору.

**Q: Как долго работает офлайн режим?**
A: Плагин может работать офлайн до 7 дней после последней проверки подписки.

**Q: Какие форматы экспорта поддерживаются?**
A: PNG, JPG и SVG с настройкой масштаба 1x, 2x, 3x.

### Для разработчиков

**Q: Можно ли изменить систему платежей?**
A: Да, замените YooKassa на любого другого провайдера, обновив webhook и API вызовы.

**Q: Как добавить новые планы подписки?**
A: Обновите объект `PLANS` в `config.js` и соответствующую логику в SQL функциях.

**Q: Поддерживается ли мультиязычность?**
A: Сейчас только русский язык, но можно легко добавить локализацию.

## 🚀 Развертывание в продакшн

### Подготовка

1. **Создайте продакшн проект** в Supabase
2. **Настройте домен** для админ-панели
3. **Получите SSL сертификаты**
4. **Настройте систему мониторинга**

### Деплой

Следуйте детальным инструкциям в [DEPLOYMENT.md](DEPLOYMENT.md)

### Масштабирование

- **До 1000 пользователей**: текущая архитектура
- **1000+ пользователей**: Supabase Pro план
- **10000+ пользователей**: кастомная инфраструктура

## 🤝 Участие в разработке

### Как внести вклад

1. **Fork** этого репозитория
2. **Создайте ветку** для новой функции
3. **Внесите изменения** и добавьте тесты
4. **Создайте Pull Request** с описанием изменений

### Стиль кода

- Используйте **ESLint** для JavaScript
- Комментируйте сложную логику
- Пишите тесты для новых функций
- Следуйте существующему стилю

## 📄 Лицензия

Этот проект распространяется под лицензией **MIT License**.

Подробности в файле [LICENSE](LICENSE).

## 🆘 Поддержка

### Получение помощи

- 📧 **Email**: support@yourcompany.com
- 💬 **Telegram**: @figma_plugin_support
- 📚 **Документация**: [DEPLOYMENT.md](DEPLOYMENT.md)
- 🐛 **Баги**: [GitHub Issues](https://github.com/yourusername/figma-bulk-export-plugin/issues)

### Коммерческая поддержка

Для настройки, кастомизации и технической поддержки обращайтесь по email.

---

<div align="center">

**Сделано с ❤️ для сообщества дизайнеров**

[⭐ Поставьте звезду](https://github.com/yourusername/figma-bulk-export-plugin) если проект был полезен!

</div>
