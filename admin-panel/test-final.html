<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <title>üß™ –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –ø–æ–¥–ø–∏—Å–∫–∏ Figma Plugin</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 18px;
            opacity: 0.9;
        }

        .main-content {
            padding: 30px;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .status-card {
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #e0e0e0;
            transition: all 0.3s ease;
        }

        .status-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .status-card.success {
            border-color: #4caf50;
            background: #f8fff8;
        }

        .status-card.warning {
            border-color: #ff9800;
            background: #fffbf0;
        }

        .status-card.error {
            border-color: #f44336;
            background: #fff8f8;
        }

        .status-card h3 {
            font-size: 18px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-icon {
            font-size: 24px;
        }

        .test-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .test-section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 22px;
        }

        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        input, select {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            min-width: 200px;
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        button.secondary {
            background: #6c757d;
        }

        button.success {
            background: #28a745;
        }

        .result-box {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 13px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }

        .result-box.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .result-box.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .result-box.info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }

        .license-display {
            background: #fff3cd;
            border: 2px solid #ffc107;
            padding: 20px;
            border-radius: 12px;
            margin: 15px 0;
        }

        .license-key {
            font-family: 'Courier New', monospace;
            font-size: 16px;
            background: #f8f9fa;
            padding: 8px 12px;
            border-radius: 6px;
            color: #495057;
            font-weight: bold;
            display: inline-block;
        }

        .figma-section {
            background: linear-gradient(135deg, #1e1e1e 0%, #333 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            margin-top: 20px;
        }

        .figma-section h2 {
            color: white;
        }

        .quick-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
            }

            .quick-actions {
                flex-direction: column;
            }

            input {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –ø–æ–¥–ø–∏—Å–∫–∏</h1>
            <p>Figma Bulk Export Plugin - –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤</p>
        </div>

        <div class="main-content">
            <!-- –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã -->
            <div class="status-grid" id="systemStatus">
                <div class="status-card" id="supabaseStatus">
                    <h3><span class="status-icon">üîó</span> Supabase</h3>
                    <p>–ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...</p>
                </div>
                <div class="status-card" id="sqlFunctionsStatus">
                    <h3><span class="status-icon">‚ö°</span> SQL –§—É–Ω–∫—Ü–∏–∏</h3>
                    <p>–¢–µ—Å—Ç–∏—Ä—É–µ–º API...</p>
                </div>
                <div class="status-card" id="serverStatus">
                    <h3><span class="status-icon">üåê</span> HTTP –°–µ—Ä–≤–µ—Ä</h3>
                    <p>–°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞...</p>
                </div>
                <div class="status-card" id="configStatus">
                    <h3><span class="status-icon">‚öôÔ∏è</span> –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è</h3>
                    <p>–ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏...</p>
                </div>
            </div>

            <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
            <div class="test-section">
                <h2>üöÄ –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h2>
                <div class="quick-actions">
                    <button onclick="runFullTest()" class="success">–ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</button>
                    <button onclick="testSupabase()">–¢–µ—Å—Ç Supabase</button>
                    <button onclick="createTestLicense()" class="secondary">–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç-–ª–∏—Ü–µ–Ω–∑–∏—é</button>
                    <button onclick="openAdminPanel()">–û—Ç–∫—Ä—ã—Ç—å –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</button>
                </div>
            </div>

            <!-- –¢–µ—Å—Ç –ø–æ–¥–ø–∏—Å–∫–∏ -->
            <div class="test-section">
                <h2>üîë –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏</h2>
                <div class="form-row">
                    <input type="email" id="testEmail" placeholder="Email –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è" value="test@demo.com">
                    <input type="text" id="testLicense" placeholder="–õ–∏—Ü–µ–Ω–∑–∏–æ–Ω–Ω—ã–π –∫–ª—é—á" value="">
                    <button onclick="testSubscription()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É</button>
                </div>
                <div class="form-row">
                    <select id="newPlan">
                        <option value="monthly">–ú–µ—Å—è—á–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞</option>
                        <option value="quarterly">–ö–≤–∞—Ä—Ç–∞–ª—å–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞</option>
                        <option value="yearly">–ì–æ–¥–æ–≤–∞—è –ø–æ–¥–ø–∏—Å–∫–∞</option>
                    </select>
                    <button onclick="createSubscription()" class="success">–°–æ–∑–¥–∞—Ç—å –ø–æ–¥–ø–∏—Å–∫—É</button>
                </div>
                <div id="subscriptionResult" class="result-box" style="display: none;"></div>
            </div>

            <!-- –¢–µ–∫—É—â–∏–µ –ª–∏—Ü–µ–Ω–∑–∏–∏ -->
            <div class="test-section">
                <h2>üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –ª–∏—Ü–µ–Ω–∑–∏–∏</h2>
                <div id="testLicenses">
                    <div class="license-display">
                        <strong>üìß Email:</strong> test@demo.com<br>
                        <strong>üîë –ö–ª—é—á:</strong> <span class="license-key" id="testKey">–ó–∞–≥—Ä—É–∂–∞–µ–º...</span><br>
                        <strong>üìÖ –ü–ª–∞–Ω:</strong> –ú–µ—Å—è—á–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞<br>
                        <button onclick="useThisLicense('test@demo.com', document.getElementById('testKey').textContent)">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —Ç–µ—Å—Ç–∞</button>
                    </div>
                </div>
            </div>

            <!-- Figma –ø–ª–∞–≥–∏–Ω -->
            <div class="figma-section">
                <h2>üé® Figma –ø–ª–∞–≥–∏–Ω</h2>
                <p>–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–ª–∞–≥–∏–Ω–∞ –≤ Figma:</p>
                <ol style="margin: 15px 0; padding-left: 20px;">
                    <li>–û—Ç–∫—Ä–æ–π—Ç–µ <strong>Figma Desktop</strong></li>
                    <li>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ <strong>Plugins ‚Üí Development</strong></li>
                    <li>–ù–∞–∂–º–∏—Ç–µ <strong>Import plugin from manifest</strong></li>
                    <li>–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª <code>manifest.json</code> –∏–∑ —ç—Ç–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞</li>
                    <li>–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø–ª–∞–≥–∏–Ω –∏ –≤–≤–µ–¥–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ</li>
                </ol>
                <div class="quick-actions">
                    <button onclick="generateManifestInfo()">–ü–æ–∫–∞–∑–∞—Ç—å manifest.json</button>
                    <button onclick="showPluginInstructions()" class="secondary">–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ</button>
                </div>
            </div>

            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
            <div class="test-section">
                <h2>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
                <div id="testResults" class="result-box info">
                    –ù–∞–∂–º–∏—Ç–µ "–ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ" –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –≤—Å–µ—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫...
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è - –†–ï–ê–õ–¨–ù–´–ï –î–ê–ù–ù–´–ï SUPABASE
        const CONFIG = {
            SUPABASE_URL: 'https://jnxywpdrnyfmfynviggu.supabase.co',
            SUPABASE_ANON_KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpueHl3cGRybnlmbWZ5bnZpZ2d1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE3OTMwOTMsImV4cCI6MjA2NzM2OTA5M30.QpR2a-HLDOJyrT4vJgsPvhcjseFr4pXj1U48gghExrc',
            ADMIN_KEY: 'figma-admin-2024-secure-key'
        };

        let currentTestLicense = '';

        // –£—Ç–∏–ª–∏—Ç—ã
        function log(message) {
            const results = document.getElementById('testResults');
            const timestamp = new Date().toLocaleTimeString();
            results.textContent += `[${timestamp}] ${message}\n`;
            results.scrollTop = results.scrollHeight;
            console.log(`[TEST] ${message}`);
        }

        function updateStatus(elementId, status, message) {
            const element = document.getElementById(elementId);
            element.className = `status-card ${status}`;
            element.querySelector('p').textContent = message;
        }

        function showResult(elementId, content, type = 'info') {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = `result-box ${type}`;
            element.textContent = content;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
        function checkConfig() {
            const isConfigured = !CONFIG.SUPABASE_URL.includes('your-project') &&
                               CONFIG.SUPABASE_URL.includes('.supabase.co') &&
                               CONFIG.SUPABASE_ANON_KEY.length > 100;

            if (isConfigured) {
                updateStatus('configStatus', 'success', '‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞');
                log('–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è');
                return true;
            } else {
                updateStatus('configStatus', 'error', '‚ùå –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞');
                log('–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: –û—à–∏–±–∫–∞');
                return false;
            }
        }

        // –¢–µ—Å—Ç Supabase –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
        async function testSupabase() {
            log('–¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Supabase...');
            updateStatus('supabaseStatus', 'warning', 'üîÑ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...');

            try {
                const response = await fetch(CONFIG.SUPABASE_URL + '/rest/v1/', {
                    method: 'HEAD',
                    headers: {
                        'apikey': CONFIG.SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${CONFIG.SUPABASE_ANON_KEY}`
                    }
                });

                if (response.ok) {
                    updateStatus('supabaseStatus', 'success', '‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ');
                    log('Supabase: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ OK');

                    // –¢–µ—Å—Ç —Ç–∞–±–ª–∏—Ü
                    await testTables();
                    return true;
                } else {
                    updateStatus('supabaseStatus', 'error', `‚ùå –û—à–∏–±–∫–∞ ${response.status}`);
                    log(`Supabase: –û—à–∏–±–∫–∞ ${response.status}`);
                    return false;
                }
            } catch (error) {
                updateStatus('supabaseStatus', 'error', '‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
                log(`Supabase: –û—à–∏–±–∫–∞ —Å–µ—Ç–∏ - ${error.message}`);
                return false;
            }
        }

        // –¢–µ—Å—Ç —Ç–∞–±–ª–∏—Ü –∏ SQL —Ñ—É–Ω–∫—Ü–∏–π
        async function testTables() {
            try {
                const response = await fetch(CONFIG.SUPABASE_URL + '/rest/v1/subscriptions?select=license_key&limit=1', {
                    method: 'GET',
                    headers: {
                        'apikey': CONFIG.SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${CONFIG.SUPABASE_ANON_KEY}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    if (data.length > 0) {
                        currentTestLicense = data[0].license_key;
                        document.getElementById('testKey').textContent = currentTestLicense;
                        document.getElementById('testLicense').value = currentTestLicense;
                    }
                    log('–¢–∞–±–ª–∏—Ü—ã: –î–æ—Å—Ç—É–ø–Ω—ã');
                }
            } catch (error) {
                log(`–¢–∞–±–ª–∏—Ü—ã: –û—à–∏–±–∫–∞ - ${error.message}`);
            }

            // –¢–µ—Å—Ç SQL —Ñ—É–Ω–∫—Ü–∏–π
            await testSQLFunctions();
        }

        // –¢–µ—Å—Ç SQL —Ñ—É–Ω–∫—Ü–∏–π
        async function testSQLFunctions() {
            log('–¢–µ—Å—Ç–∏—Ä—É–µ–º SQL —Ñ—É–Ω–∫—Ü–∏–∏...');
            updateStatus('sqlFunctionsStatus', 'warning', 'üîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ...');

            try {
                const response = await fetch(CONFIG.SUPABASE_URL + '/rest/v1/rpc/verify_subscription', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'apikey': CONFIG.SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${CONFIG.SUPABASE_ANON_KEY}`
                    },
                    body: JSON.stringify({
                        p_email: 'test@demo.com',
                        p_license_key: 'TEST-123-DEMO',
                        p_device_fingerprint: 'test-device'
                    })
                });

                if (response.ok) {
                    const result = await response.json();
                    updateStatus('sqlFunctionsStatus', 'success', '‚úÖ SQL —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç');
                    log('SQL —Ñ—É–Ω–∫—Ü–∏–∏: –†–∞–±–æ—Ç–∞—é—Ç');
                    return true;
                } else {
                    updateStatus('sqlFunctionsStatus', 'warning', '‚ö†Ô∏è –§—É–Ω–∫—Ü–∏–∏ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã');
                    log('SQL —Ñ—É–Ω–∫—Ü–∏–∏: –ù–µ –Ω–∞–π–¥–µ–Ω—ã (–≤—ã–ø–æ–ª–Ω–∏—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç—ã)');
                    return false;
                }
            } catch (error) {
                updateStatus('sqlFunctionsStatus', 'error', '‚ùå –û—à–∏–±–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π');
                log(`SQL —Ñ—É–Ω–∫—Ü–∏–∏: –û—à–∏–±–∫–∞ - ${error.message}`);
                return false;
            }
        }

        // –¢–µ—Å—Ç –ø–æ–¥–ø–∏—Å–∫–∏
        async function testSubscription() {
            const email = document.getElementById('testEmail').value;
            const license = document.getElementById('testLicense').value;

            if (!email || !license) {
                showResult('subscriptionResult', '–í–≤–µ–¥–∏—Ç–µ email –∏ –ª–∏—Ü–µ–Ω–∑–∏–æ–Ω–Ω—ã–π –∫–ª—é—á', 'error');
                return;
            }

            log(`–ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–ø–∏—Å–∫—É –¥–ª—è ${email}...`);

            try {
                const response = await fetch(CONFIG.SUPABASE_URL + '/rest/v1/rpc/verify_subscription', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'apikey': CONFIG.SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${CONFIG.SUPABASE_ANON_KEY}`
                    },
                    body: JSON.stringify({
                        p_email: email,
                        p_license_key: license,
                        p_device_fingerprint: 'test-device-web'
                    })
                });

                const result = await response.json();

                if (result.valid) {
                    const message = `‚úÖ –ü–æ–¥–ø–∏—Å–∫–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞!\n\n–î–µ—Ç–∞–ª–∏:\n- Email: ${result.email}\n- –ü–ª–∞–Ω: ${result.plan}\n- –ò—Å—Ç–µ–∫–∞–µ—Ç: ${new Date(result.expires).toLocaleDateString()}\n- –î–Ω–µ–π –æ—Å—Ç–∞–ª–æ—Å—å: ${result.days_left}\n- –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø—Ä–∏–≤—è–∑–∞–Ω–æ: ${result.device_bound ? '–î–∞' : '–ù–µ—Ç'}`;
                    showResult('subscriptionResult', message, 'success');
                    log('–ü–æ–¥–ø–∏—Å–∫–∞: –í–∞–ª–∏–¥–Ω–∞');
                } else {
                    const message = `‚ùå –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞\n\n–û—à–∏–±–∫–∞: ${result.error}`;
                    showResult('subscriptionResult', message, 'error');
                    log(`–ü–æ–¥–ø–∏—Å–∫–∞: ${result.error}`);
                }
            } catch (error) {
                showResult('subscriptionResult', `–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: ${error.message}`, 'error');
                log(`–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏: ${error.message}`);
            }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏
        async function createSubscription() {
            const email = document.getElementById('testEmail').value;
            const plan = document.getElementById('newPlan').value;

            if (!email) {
                showResult('subscriptionResult', '–í–≤–µ–¥–∏—Ç–µ email –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏', 'error');
                return;
            }

            log(`–°–æ–∑–¥–∞–µ–º –ø–æ–¥–ø–∏—Å–∫—É –¥–ª—è ${email}...`);

            try {
                const response = await fetch(CONFIG.SUPABASE_URL + '/rest/v1/rpc/create_subscription', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'apikey': CONFIG.SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${CONFIG.SUPABASE_ANON_KEY}`
                    },
                    body: JSON.stringify({
                        p_email: email,
                        p_plan: plan,
                        p_admin_key: CONFIG.ADMIN_KEY
                    })
                });

                const result = await response.json();

                if (result.success) {
                    const sub = result.subscription;
                    const message = `‚úÖ –ü–æ–¥–ø–∏—Å–∫–∞ —Å–æ–∑–¥–∞–Ω–∞!\n\n–î–µ—Ç–∞–ª–∏:\n- Email: ${sub.email}\n- –ö–ª—é—á: ${sub.license_key}\n- –ü–ª–∞–Ω: ${sub.plan}\n- –ò—Å—Ç–µ–∫–∞–µ—Ç: ${new Date(sub.expires_at).toLocaleDateString()}`;
                    showResult('subscriptionResult', message, 'success');

                    // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª–µ –ª–∏—Ü–µ–Ω–∑–∏–∏
                    document.getElementById('testLicense').value = sub.license_key;
                    log(`–ü–æ–¥–ø–∏—Å–∫–∞ —Å–æ–∑–¥–∞–Ω–∞: ${sub.license_key}`);
                } else {
                    showResult('subscriptionResult', `–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è: ${result.error}`, 'error');
                    log(`–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è: ${result.error}`);
                }
            } catch (error) {
                showResult('subscriptionResult', `–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞: ${error.message}`, 'error');
                log(`–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏: ${error.message}`);
            }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–π –ª–∏—Ü–µ–Ω–∑–∏–∏
        async function createTestLicense() {
            const testEmail = 'test-' + Date.now() + '@demo.com';
            document.getElementById('testEmail').value = testEmail;
            await createSubscription();
        }

        // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ª–∏—Ü–µ–Ω–∑–∏–∏
        function useThisLicense(email, license) {
            document.getElementById('testEmail').value = email;
            document.getElementById('testLicense').value = license;
            log(`–í—ã–±—Ä–∞–Ω–∞ –ª–∏—Ü–µ–Ω–∑–∏—è: ${email} - ${license}`);
        }

        // –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
        async function runFullTest() {
            log('üöÄ –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã...\n');

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–µ—Ä–∞
            updateStatus('serverStatus', 'success', '‚úÖ HTTP —Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç');

            const configOk = checkConfig();
            if (!configOk) return;

            const supabaseOk = await testSupabase();
            if (!supabaseOk) return;

            log('\n‚úÖ –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!');
            log('üéØ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.');
        }

        // –û—Ç–∫—Ä—ã—Ç–∏–µ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
        function openAdminPanel() {
            window.open('admin-panel.html', '_blank');
            log('–û—Ç–∫—Ä—ã—Ç–∞ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ');
        }

        // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ manifest
        function generateManifestInfo() {
            const manifestInfo = `–§–∞–π–ª –º–∞–Ω–∏—Ñ–µ—Å—Ç–∞ –ø–ª–∞–≥–∏–Ω–∞:

–ü—É—Ç—å: manifest.json

–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
{
  "name": "Bulk Export by Sections",
  "id": "1234567890",
  "api": "1.0.0",
  "main": "code-simple.js",
  "ui": "ui-final.html",
  "capabilities": [],
  "enableProposedApi": false,
  "networkAccess": {
    "allowedDomains": ["https://*.supabase.co"]
  }
}`;
            showResult('testResults', manifestInfo, 'info');
        }

        // –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –ø–ª–∞–≥–∏–Ω–∞
        function showPluginInstructions() {
            const instructions = `üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –ø–ª–∞–≥–∏–Ω–∞ –≤ Figma:

1. –û—Ç–∫—Ä–æ–π—Ç–µ Figma Desktop (–Ω–µ –≤–µ–±-–≤–µ—Ä—Å–∏—é!)
2. –í –º–µ–Ω—é –≤—ã–±–µ—Ä–∏—Ç–µ: Plugins ‚Üí Development
3. –ù–∞–∂–º–∏—Ç–µ "Import plugin from manifest"
4. –ù–∞–π–¥–∏—Ç–µ –∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª manifest.json –∏–∑ —ç—Ç–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
5. –ü–ª–∞–≥–∏–Ω –ø–æ—è–≤–∏—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
6. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø–ª–∞–≥–∏–Ω –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

üîë –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
- Email: test@demo.com
- –ö–ª—é—á: ${document.getElementById('testKey').textContent}

‚ö†Ô∏è –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏.`;
            showResult('testResults', instructions, 'info');
        }

        // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', async () => {
            log('–°–∏—Å—Ç–µ–º–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            updateStatus('serverStatus', 'success', '‚úÖ HTTP —Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç');

            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑–æ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
            setTimeout(async () => {
                checkConfig();
                await testSupabase();
            }, 1000);
        });
    </script>
</body>
</html>
