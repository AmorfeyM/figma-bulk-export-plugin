<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Админ-панель подписок Figma Plugin</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 20px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        h2 {
            font-size: 20px;
            margin-bottom: 15px;
            color: #333;
        }

        .subtitle {
            opacity: 0.9;
            font-size: 16px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-row {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }

        input, select {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            min-width: 200px;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
        }

        button {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background-color 0.2s;
        }

        button:hover {
            background: #5a6fd8;
        }

        button.secondary {
            background: #6c757d;
        }

        button.secondary:hover {
            background: #5a6268;
        }

        button.danger {
            background: #dc3545;
        }

        button.danger:hover {
            background: #c82333;
        }

        button.success {
            background: #28a745;
        }

        button.success:hover {
            background: #218838;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }

        tr:hover {
            background-color: #f8f9fa;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            display: inline-block;
        }

        .status-active {
            background: #d4edda;
            color: #155724;
        }

        .status-expired {
            background: #f8d7da;
            color: #721c24;
        }

        .status-inactive {
            background: #e2e3e5;
            color: #383d41;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-number {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #6c757d;
            font-size: 14px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }

        .success {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }

        .auth-container {
            max-width: 400px;
            margin: 100px auto;
        }

        .hidden {
            display: none;
        }

        .license-key {
            font-family: 'Courier New', monospace;
            background: #f8f9fa;
            padding: 2px 4px;
            border-radius: 2px;
            font-size: 12px;
        }

        .device-fingerprint {
            font-family: 'Courier New', monospace;
            font-size: 11px;
            color: #6c757d;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .form-row {
                flex-direction: column;
            }

            input, select {
                min-width: 100%;
            }

            table {
                font-size: 12px;
            }

            th, td {
                padding: 8px 4px;
            }
        }
    </style>
</head>
<body>
    <div id="auth-section" class="auth-container">
        <div class="card">
            <h2>Авторизация администратора</h2>
            <div class="form-group">
                <label for="admin-key">Админ-ключ:</label>
                <input type="password" id="admin-key" placeholder="Введите админ-ключ">
            </div>
            <button onclick="authenticate()" style="width: 100%;">Войти</button>
            <div id="auth-error" class="error hidden"></div>
        </div>
    </div>

    <div id="admin-panel" class="hidden">
        <div class="container">
            <div class="header">
                <h1>Админ-панель подписок</h1>
                <p class="subtitle">Figma Bulk Export Plugin - Управление подписками</p>
            </div>

            <!-- Статистика -->
            <div class="stats" id="stats-section">
                <div class="stat-card">
                    <div class="stat-number" id="total-subscriptions">-</div>
                    <div class="stat-label">Всего подписок</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="active-subscriptions">-</div>
                    <div class="stat-label">Активных</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="expired-subscriptions">-</div>
                    <div class="stat-label">Истекших</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="monthly-revenue">-</div>
                    <div class="stat-label">Доход за месяц</div>
                </div>
            </div>

            <!-- Тестирование подключения -->
            <div class="card">
                <h2>Проверка подключения</h2>
                <div class="form-row">
                    <button onclick="testConnection()" class="secondary">Тест Supabase</button>
                    <button onclick="showConfig()" class="secondary">Показать конфиг</button>
                    <button onclick="generateTestLicense()" class="success">Генерировать тест-лицензию</button>
                </div>
                <div id="connection-result" class="hidden"></div>
            </div>

            <!-- Создание подписки -->
            <div class="card">
                <h2>Создать подписку вручную</h2>
                <div class="form-row">
                    <input type="email" id="new-email" placeholder="Email клиента">
                    <select id="new-plan">
                        <option value="monthly">Месячная (30 дней)</option>
                        <option value="quarterly">Квартальная (90 дней)</option>
                        <option value="yearly">Годовая (365 дней)</option>
                    </select>
                    <button onclick="createSubscription()" class="success">Создать подписку</button>
                </div>
                <div id="create-result" class="hidden"></div>
            </div>

            <!-- Массовые операции -->
            <div class="card">
                <h2>Массовые операции</h2>
                <div class="form-row">
                    <button onclick="exportSubscriptions()" class="secondary">Экспорт в CSV</button>
                    <button onclick="cleanExpiredSubscriptions()" class="danger">Очистить истекшие</button>
                    <button onclick="sendNotifications()" class="secondary">Отправить уведомления</button>
                </div>
            </div>

            <!-- Список подписок -->
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h2>Список подписок</h2>
                    <div>
                        <input type="text" id="search-input" placeholder="Поиск по email..." style="margin-right: 10px;">
                        <button onclick="loadSubscriptions()">Обновить</button>
                    </div>
                </div>

                <div id="loading" class="loading hidden">Загрузка...</div>
                <div id="subscriptions-container">
                    <table id="subscriptions-table">
                        <thead>
                            <tr>
                                <th>Email</th>
                                <th>Лицензионный ключ</th>
                                <th>План</th>
                                <th>Статус</th>
                                <th>Создана</th>
                                <th>Истекает</th>
                                <th>Устройство</th>
                                <th>Действия</th>
                            </tr>
                        </thead>
                        <tbody id="subscriptions-list"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Конфигурация - загружается из config.js или используются значения по умолчанию
        let CONFIG = {
            SUPABASE_URL: 'https://your-project.supabase.co',
            SUPABASE_ANON_KEY: 'your_anon_key_here',
            ADMIN_KEY: 'admin-demo-key-change-this',
            DEMO_MODE: true
        };

        // Пытаемся загрузить конфигурацию из PLUGIN_CONFIG если доступна
        if (typeof PLUGIN_CONFIG !== 'undefined') {
            CONFIG = {
                SUPABASE_URL: PLUGIN_CONFIG.SUPABASE.URL,
                SUPABASE_ANON_KEY: PLUGIN_CONFIG.SUPABASE.ANON_KEY,
                ADMIN_KEY: PLUGIN_CONFIG.ADMIN.ACCESS_KEY,
                DEMO_MODE: PLUGIN_CONFIG.PLUGIN.DEMO_MODE
            };
        }

        // Проверка конфигурации
        function isConfigured() {
            return !CONFIG.SUPABASE_URL.includes('your-project') &&
                   !CONFIG.SUPABASE_ANON_KEY.includes('your_anon_key') &&
                   CONFIG.SUPABASE_URL.includes('.supabase.co');
        }

        let supabase = null
        let subscriptions = []
        let demoMode = false

        // Демо-данные для тестирования
        const DEMO_SUBSCRIPTIONS = [
            {
                id: 'demo-1',
                email: 'demo@example.com',
                license_key: 'DEMO-123456-ABCD',
                plan: 'monthly',
                status: 'active',
                created_at: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString(),
                expires_at: new Date(Date.now() + 23 * 24 * 60 * 60 * 1000).toISOString(),
                device_fingerprint: 'demo-device-123'
            },
            {
                id: 'demo-2',
                email: 'test@company.com',
                license_key: 'TEST-789012-EFGH',
                plan: 'yearly',
                status: 'active',
                created_at: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString(),
                expires_at: new Date(Date.now() + 335 * 24 * 60 * 60 * 1000).toISOString(),
                device_fingerprint: null
            },
            {
                id: 'demo-3',
                email: 'expired@test.com',
                license_key: 'OLD-345678-IJKL',
                plan: 'monthly',
                status: 'active',
                created_at: new Date(Date.now() - 60 * 24 * 60 * 60 * 1000).toISOString(),
                expires_at: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString(),
                device_fingerprint: 'expired-device-456'
            }
        ]

        // Авторизация
        function authenticate() {
            const key = document.getElementById('admin-key').value
            const errorDiv = document.getElementById('auth-error')

            if (key === CONFIG.ADMIN_KEY) {
                document.getElementById('auth-section').classList.add('hidden')
                document.getElementById('admin-panel').classList.remove('hidden')

                // Проверяем конфигурацию Supabase
                if (isConfigured()) {
                    console.log('✅ Supabase configured, using real data')
                    demoMode = false
                    supabase = window.supabase.createClient(CONFIG.SUPABASE_URL, CONFIG.SUPABASE_ANON_KEY)
                } else {
                    console.log('⚠️ Supabase not configured, using demo mode')
                    demoMode = true

                    // Показываем предупреждение о демо-режиме
                    const header = document.querySelector('.header')
                    const demoNotice = document.createElement('div')
                    demoNotice.style.cssText = 'background: #ffc107; color: #000; padding: 10px; border-radius: 4px; margin-top: 10px; font-size: 14px;'
                    demoNotice.innerHTML = '⚠️ <strong>ДЕМО-РЕЖИМ</strong> - Supabase не настроен. Показываются тестовые данные.'
                    header.appendChild(demoNotice)
                }

                loadSubscriptions()
                loadStats()
            } else {
                errorDiv.textContent = 'Неверный ключ доступа'
                errorDiv.classList.remove('hidden')
                setTimeout(() => errorDiv.classList.add('hidden'), 3000)
            }
        }

        // Загрузка статистики
        async function loadStats() {
            try {
                let data;

                if (demoMode) {
                    // Используем демо-данные
                    data = DEMO_SUBSCRIPTIONS;
                } else {
                    // Загружаем из Supabase
                    const { data: supabaseData, error } = await supabase
                        .from('subscriptions')
                        .select('status, expires_at, created_at')

                    if (error) throw error
                    data = supabaseData;
                }

                const now = new Date()
                const total = data.length
                const active = data.filter(s => s.status === 'active' && new Date(s.expires_at) > now).length
                const expired = data.filter(s => new Date(s.expires_at) <= now).length

                document.getElementById('total-subscriptions').textContent = total
                document.getElementById('active-subscriptions').textContent = active
                document.getElementById('expired-subscriptions').textContent = expired

                // Примерный расчет дохода (если есть данные о платежах)
                document.getElementById('monthly-revenue').textContent = '₽' + (active * 500).toLocaleString()

            } catch (error) {
                console.error('Error loading stats:', error)

                // Fallback к демо-данным при ошибке
                if (!demoMode) {
                    console.log('Falling back to demo data due to error')
                    demoMode = true
                    loadStats()
                }
            }
        }

        // Загрузка подписок
        async function loadSubscriptions() {
            const loading = document.getElementById('loading')
            loading.classList.remove('hidden')

            try {
                let data;

                if (demoMode) {
                    // Используем демо-данные
                    console.log('Loading demo subscriptions data')
                    data = [...DEMO_SUBSCRIPTIONS].sort((a, b) => new Date(b.created_at) - new Date(a.created_at))
                } else {
                    // Загружаем из Supabase
                    const { data: supabaseData, error } = await supabase
                        .from('subscriptions')
                        .select('*')
                        .order('created_at', { ascending: false })

                    if (error) throw error
                    data = supabaseData
                }

                subscriptions = data
                renderSubscriptions(data)

            } catch (error) {
                console.error('Error loading subscriptions:', error)

                // Fallback к демо-данным при ошибке
                if (!demoMode) {
                    console.log('Falling back to demo data due to error')
                    demoMode = true
                    const demoData = [...DEMO_SUBSCRIPTIONS].sort((a, b) => new Date(b.created_at) - new Date(a.created_at))
                    subscriptions = demoData
                    renderSubscriptions(demoData)
                } else {
                    alert('Ошибка загрузки: ' + error.message)
                }
            } finally {
                loading.classList.add('hidden')
            }
        }

        // Отображение подписок
        function renderSubscriptions(data) {
            const tbody = document.getElementById('subscriptions-list')
            tbody.innerHTML = ''

            data.forEach(sub => {
                const row = document.createElement('tr')
                const isExpired = new Date(sub.expires_at) < new Date()
                const isActive = sub.status === 'active' && !isExpired

                let statusClass = 'status-inactive'
                let statusText = sub.status

                if (isActive) {
                    statusClass = 'status-active'
                    statusText = 'Активна'
                } else if (isExpired) {
                    statusClass = 'status-expired'
                    statusText = 'Истекла'
                }

                row.innerHTML = `
                    <td>
                        <strong>${sub.email}</strong>
                    </td>
                    <td>
                        <span class="license-key">${sub.license_key}</span>
                    </td>
                    <td>${getPlanName(sub.plan)}</td>
                    <td>
                        <span class="status-badge ${statusClass}">${statusText}</span>
                    </td>
                    <td>${formatDate(sub.created_at)}</td>
                    <td>${formatDate(sub.expires_at)}</td>
                    <td>
                        ${sub.device_fingerprint ?
                            `<span class="device-fingerprint">${sub.device_fingerprint}</span>` :
                            '<em>Не привязано</em>'
                        }
                    </td>
                    <td>
                        <button onclick="extendSubscription('${sub.id}')" class="success" title="Продлить на месяц">+1М</button>
                        <button onclick="resetDevice('${sub.id}')" class="secondary" title="Сбросить устройство">Сброс</button>
                        <button onclick="deactivateSubscription('${sub.id}')" class="danger" title="Деактивировать">✕</button>
                    </td>
                `
                tbody.appendChild(row)
            })
        }

        // Поиск подписок
        document.getElementById('search-input').addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase()
            const filtered = subscriptions.filter(sub =>
                sub.email.toLowerCase().includes(query) ||
                sub.license_key.toLowerCase().includes(query)
            )
            renderSubscriptions(filtered)
        })

        // Создание подписки
        async function createSubscription() {
            const email = document.getElementById('new-email').value.trim()
            const plan = document.getElementById('new-plan').value
            const resultDiv = document.getElementById('create-result')

            if (!email) {
                showResult(resultDiv, 'Введите email', 'error')
                return
            }

            if (!isValidEmail(email)) {
                showResult(resultDiv, 'Введите корректный email', 'error')
                return
            }

            try {
                const expiresAt = new Date()
                if (plan === 'monthly') {
                    expiresAt.setMonth(expiresAt.getMonth() + 1)
                } else if (plan === 'quarterly') {
                    expiresAt.setMonth(expiresAt.getMonth() + 3)
                } else if (plan === 'yearly') {
                    expiresAt.setFullYear(expiresAt.getFullYear() + 1)
                }

                const licenseKey = generateLicenseKey()

                const { error } = await supabase
                    .from('subscriptions')
                    .insert({
                        email: email.toLowerCase(),
                        license_key: licenseKey,
                        plan: plan,
                        status: 'active',
                        expires_at: expiresAt.toISOString()
                    })

                if (error) throw error

                showResult(resultDiv, `
                    <strong>Подписка создана!</strong><br>
                    Email: ${email}<br>
                    Ключ: <span class="license-key">${licenseKey}</span><br>
                    Действует до: ${formatDate(expiresAt.toISOString())}
                `, 'success')

                document.getElementById('new-email').value = ''
                loadSubscriptions()
                loadStats()

            } catch (error) {
                showResult(resultDiv, 'Ошибка: ' + error.message, 'error')
            }
        }

        // Продление подписки
        async function extendSubscription(id) {
            try {
                const { data: sub } = await supabase
                    .from('subscriptions')
                    .select('expires_at')
                    .eq('id', id)
                    .single()

                const currentExpiry = new Date(sub.expires_at)
                const newExpiry = new Date(currentExpiry)
                newExpiry.setMonth(newExpiry.getMonth() + 1)

                const { error } = await supabase
                    .from('subscriptions')
                    .update({
                        expires_at: newExpiry.toISOString(),
                        status: 'active'
                    })
                    .eq('id', id)

                if (error) throw error

                alert('Подписка продлена на месяц до ' + formatDate(newExpiry.toISOString()))
                loadSubscriptions()
                loadStats()

            } catch (error) {
                alert('Ошибка: ' + error.message)
            }
        }

        // Сброс устройства
        async function resetDevice(id) {
            if (!confirm('Сбросить привязку к устройству? Пользователь сможет активировать лицензию на новом устройстве.')) {
                return
            }

            try {
                const { error } = await supabase
                    .from('subscriptions')
                    .update({ device_fingerprint: null })
                    .eq('id', id)

                if (error) throw error

                alert('Привязка к устройству сброшена')
                loadSubscriptions()

            } catch (error) {
                alert('Ошибка: ' + error.message)
            }
        }

        // Деактивация подписки
        async function deactivateSubscription(id) {
            if (!confirm('Деактивировать подписку? Это действие нельзя отменить.')) {
                return
            }

            try {
                const { error } = await supabase
                    .from('subscriptions')
                    .update({ status: 'inactive' })
                    .eq('id', id)

                if (error) throw error

                alert('Подписка деактивирована')
                loadSubscriptions()
                loadStats()

            } catch (error) {
                alert('Ошибка: ' + error.message)
            }
        }

        // Экспорт в CSV
        async function exportSubscriptions() {
            try {
                const csv = [
                    ['Email', 'License Key', 'Plan', 'Status', 'Created', 'Expires', 'Device'].join(','),
                    ...subscriptions.map(sub => [
                        sub.email,
                        sub.license_key,
                        sub.plan,
                        sub.status,
                        formatDate(sub.created_at),
                        formatDate(sub.expires_at),
                        sub.device_fingerprint || ''
                    ].join(','))
                ].join('\n')

                const blob = new Blob([csv], { type: 'text/csv' })
                const url = URL.createObjectURL(blob)
                const a = document.createElement('a')
                a.href = url
                a.download = `subscriptions-${new Date().toISOString().slice(0, 10)}.csv`
                a.click()
                URL.revokeObjectURL(url)

            } catch (error) {
                alert('Ошибка экспорта: ' + error.message)
            }
        }

        // Очистка истекших подписок
        async function cleanExpiredSubscriptions() {
            if (!confirm('Удалить все истекшие более 30 дней подписки? Это действие нельзя отменить.')) {
                return
            }

            try {
                const cutoffDate = new Date()
                cutoffDate.setDate(cutoffDate.getDate() - 30)

                const { error } = await supabase
                    .from('subscriptions')
                    .delete()
                    .lt('expires_at', cutoffDate.toISOString())

                if (error) throw error

                alert('Старые подписки удалены')
                loadSubscriptions()
                loadStats()

            } catch (error) {
                alert('Ошибка: ' + error.message)
            }
        }

        // Отправка уведомлений (заглушка)
        function sendNotifications() {
            alert('Функция отправки уведомлений будет реализована в следующей версии')
        }

        // Утилиты
        function generateLicenseKey() {
            const timestamp = Date.now().toString().slice(-6)
            const random = Math.random().toString(36).substr(2, 8).toUpperCase()
            return `FIGMA-${timestamp}-${random}`
        }

        function getPlanName(plan) {
            const plans = {
                'monthly': 'Месячная',
                'quarterly': 'Квартальная',
                'yearly': 'Годовая'
            }
            return plans[plan] || plan
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('ru-RU', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            })
        }

        function isValidEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)
        }

        function showResult(element, message, type) {
            element.innerHTML = message
            element.className = type
            element.classList.remove('hidden')
            setTimeout(() => element.classList.add('hidden'), 5000)
        }

        // Обработка Enter для авторизации
        document.getElementById('admin-key').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                authenticate()
            }
        })

        // Функции тестирования
        async function testConnection() {
            const resultDiv = document.getElementById('connection-result')
            resultDiv.classList.remove('hidden')
            resultDiv.innerHTML = '🔄 Тестирование подключения...'

            if (demoMode) {
                showResult(resultDiv, '⚠️ Демо-режим активен. Supabase не настроен.', 'error')
                return
            }

            try {
                // Тест базового подключения
                const response = await fetch(CONFIG.SUPABASE_URL + '/rest/v1/', {
                    method: 'HEAD',
                    headers: {
                        'apikey': CONFIG.SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${CONFIG.SUPABASE_ANON_KEY}`
                    }
                })

                if (response.ok) {
                    // Тест подключения к таблице
                    const tableTest = await supabase
                        .from('subscriptions')
                        .select('id')
                        .limit(1)

                    if (tableTest.error) {
                        showResult(resultDiv, `❌ Таблицы не найдены: ${tableTest.error.message}`, 'error')
                    } else {
                        showResult(resultDiv, '✅ Подключение к Supabase успешно!', 'success')
                    }
                } else {
                    showResult(resultDiv, `❌ Ошибка подключения: ${response.status} ${response.statusText}`, 'error')
                }
            } catch (error) {
                showResult(resultDiv, `❌ Ошибка сети: ${error.message}`, 'error')
            }
        }

        function showConfig() {
            const resultDiv = document.getElementById('connection-result')
            resultDiv.classList.remove('hidden')

            const configInfo = `
                <strong>Текущая конфигурация:</strong><br>
                • URL: ${CONFIG.SUPABASE_URL}<br>
                • API Key: ${CONFIG.SUPABASE_ANON_KEY.substring(0, 20)}...<br>
                • Админ ключ: ${CONFIG.ADMIN_KEY}<br>
                • Демо-режим: ${demoMode ? 'Да' : 'Нет'}<br>
                • Настроен: ${isConfigured() ? 'Да' : 'Нет'}
            `
            showResult(resultDiv, configInfo, 'success')
        }

        function generateTestLicense() {
            const resultDiv = document.getElementById('connection-result')
            resultDiv.classList.remove('hidden')

            const timestamp = Date.now().toString().slice(-6)
            const random = Math.random().toString(36).substr(2, 8).toUpperCase()
            const testLicense = `TEST-${timestamp}-${random}`

            const licenseInfo = `
                <strong>Тестовая лицензия сгенерирована:</strong><br>
                📧 Email: test@demo.com<br>
                🔑 Ключ: <span style="background: #f0f0f0; padding: 2px 4px; font-family: monospace;">${testLicense}</span><br>
                ⏰ Срок: 30 дней<br><br>
                <small>Используйте эти данные для тестирования плагина</small>
            `
            showResult(resultDiv, licenseInfo, 'success')

            console.log('Test license generated:', {
                email: 'test@demo.com',
                license_key: testLicense,
                expires: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString()
            })
        }

        // Информация при загрузке
        console.log('🔧 Figma Plugin Admin Panel v1.1')
        console.log('🔐 Введите админ-ключ для доступа к панели управления')
        console.log('⚙️ Конфигурация:', { configured: isConfigured(), demoMode: CONFIG.DEMO_MODE })
    </script>
</body>
</html>
